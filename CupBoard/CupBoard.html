<!DOCTYPE html>
<html>


    <script src="../lib/OpenPlus.js"></script>
    <script src="../lib/verb.js"></script>
    <script src="../lib/three.min.js"></script>
    <script src="../lib/verbToThreeConversion.js"></script>
    <script src="../lib/OrbitControls.js"></script>
    <script src="../lib/threeBasic.js"></script>
    <script src="../lib/STLLoader.js"></script>
    <script src="../lib/ObjectControls.js"></script>

    <!--parts-->
    <script src="parts/leg.js"></script>
    <script src="parts/rib.js"></script>
    <script src="parts/plate.js"></script>
    <script src="parts/connectorLegWallShelf.js"></script>
    <script src="parts/connectorWallCornerShelf.js"></script>
    <script src="parts/connectorLegWallShelf_1.js" type="text/javascript"></script>

    <!--blocks-->
    <script src="blocks/LowerBackConnector.js" type="text/javascript"></script>
    <script src="blocks/LowerFrontConnector.js" type="text/javascript"></script>
    <script src="blocks/TopBackConnector.js" type="text/javascript"></script>
    <script src="blocks/TopFrontConnector.js" type="text/javascript"></script>

    <style type="text/css">
        body { 
            margin: 0; 
            background: white;

            text-align: center;
        }

        .centerDiv {

            position: absolute;
            left: 50%;
            top: 5%;

            text-align: left;
        }

        .titleContainer {
            font-family:"Tahoma";
            font-weight: bold;

            position: relative;
            left: -50%;

            z-index: -1;
        }

        #objectContainer {
        }

        .mainTitle {
            font-size: 1000%;
        }

        .product {
            font-size: 300%;
        }

        .part {
            font-size: 150%;

            text-align: left;
        }
    </style>

    <body>

        <div id="objectContainer">
        </div>

        <div class="centerDiv">
            <div class="titleContainer">
                <span class="mainTitle">PS</span><span class="mainTitle">/</span><span class="product">Cupboard</span><br>
                <span class="part">LEG</span><span class="part"> + </span><span class="part">WALL</span><span class="part"> + </span><span class="part">SHELF</span>
            </div>
        </div>

        <script>


            threeSetup();



            ThinNut = function (mSize) {
                this.m = mSize;

                this.height = (0.5 * mSize);
                this.diameter = 2 * mSize;
                this.width = 2 * Math.sqrt((mSize * mSize) - ((mSize / 2) * (mSize / 2)));
            };

            CupBoard = function (width, depth, height, containerHeight) {
                //overal variables
                this.height = height;
                this.width = width;
                this.depth = depth;
                this.containerHeight = containerHeight;

                //bought variables - moet die nog min maxxen
                this.legDiameter = 22;
                this.ribThicknessX = 9;
                this.ribThicknessY = 9;
                this.shelfThickness = 18;
                this.wallThickness = 6;

                this.nut = new ThinNut(3);

                //
                this.margin = 0.3;
                this.offset = 2;
                this.extraOnZRib = 5;

                //printed variables
                this.connectorLegWallShelf;
                this.connectorLegShelf;
                this.connectorLegShelfWall;

                //build the cupboard;
                this.CalcDims();
                this.Build();
                this.Construct();
            };

            CupBoard.prototype.CalcDims = function () {
                var _margin = this.margin * 4;
                var _offset = this.offset * 2;
                var _ribTX = this.ribThicknessX;
                var _ribTY = this.ribThicknessY;
                var _legDiam = this.legDiameter;
                var _width = this.width;
                var _depth = this.depth;
                var _contHeigth = this.containerHeight;

                //dimensions ribs
                this.ribXLength = _width -
                        (_legDiam + _margin + _offset + (_ribTX * 2));

                this.ribYLength = _depth -
                        (_legDiam + _margin + _offset + (_ribTX * 2));

                this.ribZLength = _contHeigth + (_margin / 2) +
                        ((this.nut.width + this.extraOnZRib) * 2);

                //dimensions wall plates
                this.plateLength = _contHeigth - (_ribTY * 2) - _offset - _margin;
                this.plateWidthX = this.ribXLength - _offset - _margin;
                this.plateWidthY = this.ribYLength - _offset - _margin;

                //dimensions top and bottom plate
                var tempDistA = (Math.sin(Math.PI / 4) * _legDiam) + (_margin / 2);
                var tempDistB = _ribTX + _margin + _offset;

                this.plateMargin = tempDistA > tempDistB ?
                        ((tempDistA - tempDistB) / 2) + this.offset : this.offset;

                this.topBotWidth = _width - _ribTX - _margin - (this.plateMargin * 2);
                this.topBotDepth = _depth - _ribTX - _margin - (this.plateMargin * 2);

                //dimensions for shelf
                this.shelfWidth = _width - _ribTX - _margin - (((tempDistA - tempDistB) / 2) + this.offset * 2);
                this.shelfDepth = _depth - _ribTX - _margin - (((tempDistA - tempDistB) / 2) + this.offset * 2);
            };

            CupBoard.prototype.Build = function () {
                var d1 = Date.now();

                this.leg = new Leg(this.legDiameter, this.height);

                this.ribX = new Rib(this.ribThicknessX, this.ribThicknessY,
                        this.ribXLength, [1, 0, 0]);
                this.ribY = new Rib(this.ribThicknessX, this.ribThicknessY,
                        this.ribYLength, [0, 1, 0]);
                this.ribZ = new Rib(this.ribThicknessX, this.ribThicknessY,
                        this.ribZLength, [0, 0, 1]);

                this.plateX = new Plate(this.plateWidthX, this.plateLength,
                        this.wallThickness, [0, 1, 0]);
                this.plateY = new Plate(this.plateWidthY, this.plateLength,
                        this.wallThickness, [1, 0, 0]);

                this.topBot = new Plate(this.topBotWidth, this.topBotDepth,
                        this.shelfThickness, [0, 0, 1]);

                this.shelf = new Plate(this.shelfWidth, this.shelfDepth,
                        this.shelfThickness, [0, 0, 1]);

                //create connector archetypes
                var connectorLegWallShelf = new ConnectorLegWallShelf(
                        this.leg, this.ribX, this.nut, this.plateMargin);

                var connectorWallCornerShelf = new ConnectorWallCornerShelf(
                        this.leg, this.topBot, this.plateX, this.ribX, this.nut, this.plateMargin);

                //create combined objects out of prototypes
                this.lowerBackConnector = new LowerBackConnector(
                        connectorLegWallShelf, connectorWallCornerShelf, this.ribX, this.nut);

                this.lowerFrontConnector = new LowerFrontConnector(
                        connectorLegWallShelf, connectorWallCornerShelf, this.ribX, this.nut);

                this.topBackConnector = new TopBackConnector(
                        connectorLegWallShelf, connectorWallCornerShelf, this.ribX, this.nut);

                this.topFrontConnector = new TopFrontConnector(
                        connectorLegWallShelf, connectorWallCornerShelf, this.ribX, this.nut);

                this.shelfRest = connectorLegWallShelf.clone();
                this.shelfRest.buildShelfRest();

                var d2 = Date.now();
                console.log("built connectors in ", (d2 - d1), " ms ");
            };

            CupBoard.prototype.Construct = function () {
                //ordenen van de objecten
                var width = this.width;
                var depth = this.depth;
                var height = this.height;

                var heightA = height - (this.ribThicknessY / 2)
                        - this.nut.width - this.margin;
                var heightB = (heightA + this.ribThicknessY)
                        - this.containerHeight;

                for (var i = 0; i < 4; i++) {
                    var legClone = this.leg.mesh.clone();
                    var ribX = this.ribX.mesh.clone();
                    var ribY = this.ribY.mesh.clone();

                    legClone.translateX(
                            (i === 0 || i === 3) ? width / 2 : -width / 2);
                    legClone.translateY((i < 2) ? depth / 2 : -depth / 2);

                    ribX.translateY((i < 2) ? depth / 2 : -depth / 2);
                    ribX.translateZ((i === 0 || i === 3) ? heightA : heightB);

                    ribY.translateX((i < 2) ? width / 2 : -width / 2);
                    ribY.translateZ((i === 0 || i === 3) ? heightA : heightB);

                    scene.add(legClone);
                    scene.add(ribX);
                    scene.add(ribY);
                }

                var heightC = height - (this.ribZLength / 2) + this.extraOnZRib;

                var posX = (this.ribXLength / 2) + (this.ribThicknessX / 2);
                var posY = (this.ribYLength / 2) + (this.ribThicknessX / 2);

                for (var i = 0; i < 4; i++) {
                    var ribA = this.ribZ.mesh.clone();
                    var ribB = this.ribZ.mesh.clone();

                    ribA.translateZ(heightC);
                    ribB.translateZ(heightC);

                    ribA.translateX((i === 0 || i === 3) ? posX : -posX);
                    ribA.translateY((i < 2) ? depth / 2 : -depth / 2);

                    ribB.translateX((i === 0 || i === 3) ? width / 2 : -width / 2);
                    ribB.translateY((i < 2) ? posY : -posY);

                    scene.add(ribA);
                    scene.add(ribB);
                }

                var widthA = (width / 2) +
                        ((this.ribThicknessX / 2) - (this.wallThickness / 2));
                var depthA = (depth / 2) +
                        ((this.ribThicknessX / 2) - (this.wallThickness / 2));

                var plateYA = this.plateY.mesh.clone();
                var plateYB = this.plateY.mesh.clone();
                var plateX = this.plateX.mesh.clone();

                plateYA.translateZ(heightC);
                plateYB.translateZ(heightC);
                plateX.translateZ(heightC);

                plateYA.translateX(widthA);
                plateYB.translateX(-widthA);
                plateX.translateY(depthA);

                scene.add(plateYA);
                scene.add(plateYB);
                scene.add(plateX);

                var heightD = height - (this.shelfThickness / 2)
                        - this.nut.width - this.margin;
                var heightE = (heightD + this.shelfThickness)
                        - this.containerHeight;

                var plateHorA = this.topBot.mesh.clone();
                var plateHorB = this.topBot.mesh.clone();

                plateHorA.translateZ(heightD);
                plateHorB.translateZ(heightE);

                scene.add(plateHorA);
                scene.add(plateHorB);

                //placement of the connectors
                var tBConA = this.topBackConnector.mesh(
                        [width / 2, depth / 2, height - this.nut.width],
                        [0, 0, Math.PI]);

                var tBConB = this.topBackConnector.mesh(
                        [-width / 2, depth / 2, height - this.nut.width],
                        [0, 0, Math.PI * 1.5]);

                scene.add(tBConA);
                scene.add(tBConB);

                var tFConA = this.topFrontConnector.mesh(
                        [width / 2, -depth / 2, height - this.nut.width],
                        [0, 0, Math.PI / 2]);

                var tFConB = this.topFrontConnector.mesh(
                        [-width / 2, -depth / 2, height - this.nut.width],
                        [0, 0, Math.PI / 2], [-1, 1, 1], true);

                scene.add(tFConA);
                scene.add(tFConB);

                var lBConA = this.lowerBackConnector.mesh(
                        [width / 2, depth / 2, height - (this.nut.width + this.margin) - this.containerHeight],
                        [Math.PI, 0, Math.PI * 1.5]);

                var lBConB = this.lowerBackConnector.mesh(
                        [-width / 2, depth / 2, height - (this.nut.width + this.margin) - this.containerHeight],
                        [Math.PI, 0, 0]);

                scene.add(lBConA);
                scene.add(lBConB);

                var lFConA = this.lowerFrontConnector.mesh(
                        [width / 2, -depth / 2, height - (this.nut.width + this.margin) - this.containerHeight],
                        [0, 0, Math.PI / 2], [1, 1, -1], true);

                var lFConB = this.lowerFrontConnector.mesh(
                        [-width / 2, -depth / 2, height - (this.nut.width + this.margin) - this.containerHeight],
                        [Math.PI, 0, Math.PI / 2]);


                scene.add(lFConA);
                scene.add(lFConB);

                //add first shelf

                var heightF = heightB + 150;
                
                var angle = Math.PI;

                var material = new THREE.MeshLambertMaterial({
                    color: 0x99ff66
                    , side: THREE.FrontSide
                });

                for (var i = 0; i < 4; i++) {
                    
                    var shelfHolderClone = this.shelfRest.geom.clone();
                    
                    shelfHolderClone.rotateZ (angle);
                    angle = angle + (Math.PI / 2);
                    
                    var shelfHolderMesh = new THREE.Mesh(shelfHolderClone, material);

                    shelfHolderMesh.translateX(
                            (i === 0 || i === 3) ? width / 2 : -width / 2);
                    shelfHolderMesh.translateY((i < 2) ? depth / 2 : -depth / 2);
                    shelfHolderMesh.translateZ(heightF);

                    scene.add(shelfHolderMesh);
                }
                
                var firstShelf = this.shelf.mesh.clone();
                
                firstShelf.translateZ(heightF + this.nut.width + ((this.shelfThickness)/2) + this.margin);
                
                scene.add(firstShelf);

            };

            var cupboard = new CupBoard(600, 300, 700, 400);

            threeRender();

        </script>

    </body>

</html>